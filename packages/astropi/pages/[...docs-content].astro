---
import { getCollectionTypeEntries } from "../utils/collections-entries"
import Layout from "../layouts/Layout.astro"
import HeaderNavLink from "../components/header/HeaderNavLink.astro"
/**
 * this generate the pages inside blog's collections.
 */
export async function getStaticPaths() {
  return getCollectionTypeEntries("docs-content")
}

// Check if a path matches the current page
const isCurrentPage = (path: string) => {
  const currentPage = Astro.url.pathname.split("/")[2]
  return currentPage === path
}

const allDocs = await getCollectionTypeEntries("docs-content")
const { entry } = Astro.props
const { Content } = await entry.render()
---

<Layout title={entry.data.title} description={entry.data.description}>
  <aside class="sidebar">
    <select>
      <option value="en">v1.2.0</option>
      <option value="es">v0.15.4</option></select
    >
    <h3>Getting started</h3>
    {
      allDocs.map((doc) => (
        <HeaderNavLink
          url={doc.params.slug}
          isCurrent={isCurrentPage(doc.params.slug)}
        >
          {doc.props.entry.data.title}
        </HeaderNavLink>
      ))
    }
  </aside>
  <main>
    <section>
      <h1>{entry.data.title}</h1>
    </section>
    <section>
      <Content />
    </section>
  </main>
  <aside class="sidebar">
    <h3>On this page</h3>
  </aside>

  <style>
    main {
      width: 70ch;
    }
    .sidebar {
      display: flex;
      flex-direction: column;
      margin: 1.5rem;
      width: 250px;
      font-size: 0.9rem;
    }
    .sidebar a {
      display: flex;
      padding: 0.25rem 0.5rem;
      gap: 0.25rem;
      align-items: center;
      border-radius: 0.5rem;
      border: 1px solid transparent;
      text-decoration-line: none;
    }
    .sidebar a:hover {
      background-color: var(--color-lighter);
    }
    .sidebar a:active {
      color: var(--color-primary);
    }
    .sidebar h3 {
      font-size: 0.9rem;
      margin-left: 0.5rem;
      margin-bottom: 0.25rem;
    }
    .sidebar select {
      margin-bottom: 1rem;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid var(--color-light);
      background-color: white;
    }
  </style>
</Layout>
